<b># kakaoCardServer</b><br>
<b>카카오페이 경력 과제</b><br><br>


개발 언어 : JAVA -> 1.8 <br>
DBMS : h2 -> 1.4.1999 <br>
FrameWork : Spring Boot ->  3.9.12.RELEASE <br><br>


->크롬 ARC 확장 프로그램 설치 <br><br>
기본 접속 URL : http://localhost:9090  <br><br>


<b>필수문제 </b> <br>
결제 API <br><br>

http://localhost:9090/pay <br><br>

req 예제) <br>
{ "cardNo" : "1234567890123456" <br>
  ,"extMmYy" : "0420" <br>
  ,"cvcNo" : "333" <br> 
  ,"insMth" : 1 <br>
  ,"payAmt" : 10000 <br>
  ,"vatAmt" : 0   <br>
} <br><br>

res 예제) <br>
{ <br>
"mgnNo": "20042323095336000002", <br>
"rsltStsMsg": "성공", <br>
"msg": "관리번호 : [20042323095336000002] 10,000(909)원 결제 성공" <br>
} <br><br>

취소 API <br>
http://localhost:9090/cancel<br><br>

req 예제) <br>
{ "cancelMgnNo" : "20042323095336000002" <br>
  ,"payAmt" : 1000 <br>
  ,"vatAmt" : 0   <br>
}


res 예제) <br>
{"mgnNo": "20042323115144000004",<br>
"rsltStsMsg": "성공",<br>
"resPayAmtTot": 9818,<br>
"resPayAmt": 9000,<br>
"resVatAmt": 818,<br>
"msg": "관리번호 : [20042323115144000004] 1,000(91)원 취소 성공 관리번호의 취소후 남은 총 결제금액 = (총 결제금액 + 총 부가세금액) 9818 = (9000 + 818)원"<br>
}<br><br>





조회 API <br>
http://localhost:9090/search <br><br>

req 예제) <br>
{ "mgnNo" : "20042323115144000004"   <br>
}<br><br>

res 예제) <br>
{<br>
  "mgnNo": "20042323115144000004",<br>
  "cardInfo": {<br>
  "cardNo": "123456*******456",<br>
  "extMmYy": "0420",<br>
  "cvcNo": "333"<br>
  },<br>
  "payMsg": "취소",<br>
  "payCanAmtInfo": {<br>
  "payAmt": 1000,<br>
  "vatAmt": 91<br>
  },<br>
  "amtInfo": {<br>
  "totalAmt": 9818,<br>
  "payAmt": 9000,<br>
  "vatAmt": 818<br>
  }<br>
}<br><br><br><br>








<b>Junit 테스트</b><br><br>

MultiThreadTest.java<br>
-> 하나의_카드번호로_동시에_결제불가 (@Test 실행)   <br>
-> 멀티쓰레드_취소_진행중 (@Test 실행)<br><br>

PayTest.java<br>
-> 과제테스트_리스트1 (@Test 실행)<br>
//		testcase1						<br>
//		결제1		11,000	1,000	성공	11,000	1,000	11,000(1,000)원 결제 성공<br>
//		부분취소1	1,100	100	성공	9,900	900	1,100(100)원 취소 성공<br>
//		부분취소2	3,300	0	성공	6,600	600	3,300원 취소 성공<br>
//		부분취소3	7,000	0	실패	6,600	600	7,000원 취소하려 했으나 남은 결제금액 보다 커서 실패 <br>
//		부분취소4	6,600	700	실패	6,600	600	6,600(700)원 취소하려 했으나 남은 부 가가치세보다 취소요청 부가가치세가 커 서 실패<br>
//		부분취소5	6,600	600	성공	0	0	6,600(600)원 성공 부분취소<br>
//		부분취소6	100	0	실패	0	0	100원 취소하려했으나 남은 결제금액이없어서 실패<br><br>

-> 과제테스트_리스트2 (@Test 실행)<br>
//		testcase2						<br>
//		결제1	20,000	909	성공	20,000	909	20,000(909)원 결제성공<br>
//		부분취소1	10,000	0	성공	10,000	909	10,000(0)원 취소성공<br>
//		부분취소2	10,000	0	실패	10,000	909	10,000(0)원 취소하려했으나 남은부가 가치세 금액(909)이더크므로실패<br>
//		부분취소3	10,000	909	성공	0	0	10,000(909)원 취소성공<br><br>



-> 과제테스트_리스트3 (@Test 실행)<br>
//		testcase3						<br>
//		결제1	20,000	null	성공	20,000	1,818	20,000원 결제 성공, 부가가치세 (1,818) 자동계산<br>
//		부분취소1	10,000	1,000	성공	10,000	818	10,000(1,000)원 취소 성공<br>
//		부분취소2	10,000	909	실패	10,000	818	10,000(909)원 취소하려했으나남은 부가가치세가 더 작으므로 실패<br>
//		부분취소3	10,000	null	성공	0	0	10,000원 취소,남은 부가가치세는 818원으로 자동계산되어 성공<br><br>

<br><br>
String1 결제 데이타
" 450PAYMENT   200424003715460000011234567890123456    010420333     100000000000909                    f60732a781105215b5f64bb3f2b133abb46ec06a644a03d13a21d045880479064632608823507c82f1f5bad51a5539dc000fda2d6c92c9e805fb7044085619af13b4c658a531559fb8fd19fed84a3018                                                                                                                                                                                           "                                                             <br><br>             
String 취소 데이타
" 450CANCEL    200424003722300000021234567890123456    010420333     100000000000909200424003715460000010afae264e215479106b5f0848acf8dc341cf5ba292ad5977fd6e4836fdfa355e                                                                                                                                                                                                                                                                                           "
<br><br>
DB접속 방법<<br>
H2 DB Console 접속 URL : http://localhost:9090/h2-console/  <br><br>

Driver Class : org.h2.Driver <br>
JDBC URL : jdbc:h2:mem:test <br>
USER NAME : sa <br>
Passworld :  <br><br><br>









<b>제약사항(필수)<b><br><br>
 
카드사와 통신하는 부분은 Embedded Database(ex. H2)에 string 데이터를 저장하는 것으로 대체하고 <br>
카드사로 전송하는 모든 요청은 성공이라고 가정합니다. <br><br>

서비스에 필요한 테이블은 자유롭게 설계하세요.  <b>(완료)</b><br>
string 데이터는 참고1. string 데이터 명세를 참고하세요. <b>(완료)</b><br>
string 데이터는 꼭 저장되어야 합니다. 단위 테스트(Unit Test) 로 각 기능을 검증하세요. <b>(완료)</b><br>
api interface는 자유롭게 설계하되 입출력은 json format으로 제한합니다.  <b>(완료)</b><br>
각 api의 HTTP Method들( GET | POST | PUT | DEL )은 자유롭게 선택하세요.  <b>(완료 POST방식 사용)</b><br>
README.md 파일 작성 <b>(완료)</b><br>
개발 프레임워크 <b>(완료)</b><br>
테이블 설계 <b>(완료 "카드 결제 Project.xlsx")</b> <br>
빌드 및 실행 방법기술.  <b>(완료)</b><br>
charset은 UTF-8을 사용해주세요. 에러응답, 에러코드는 자유롭게 정의해주세요. <b>(완료)</b><br><br>

프로그램 언어는 평가에 반되지 않으니 자유롭게 선택하세요. 선택 문제는 추가 점수가 있으니 시간이 되시면 구현해주세요. <br>


문제해결 전략 <b>(완료)</b><br>
1. 결제  API 전략<br>
 〮 결제시 부가세금액<br>
  - 전제조건 "(결제금액/11)소수점이하반올림" 보다 클 수 없음<br>
  - 0이거나 null인경우 "(결제금액/11)소수점이하반올림" 금액<br>
 〮 response 추가<br>
  - 남은 총 결제금액<br>
  - 남은 결제금액<br>
  - 남은 부가세금액<br>
 〮 결제API는 결제 테이블에 INSERT<br>
  - INSERT시 결제 상태정보를 입력하여 결제중인 경우 동시에 같은 카드번호 입력이 되고 있다면 처리 불가<br>
 〮 유효기간이 현재월 보다 작은경우 <br>
  - 유효기간이 지난 카드 확인 요청<br><br>

2. 취소  API 전략<br>
 〮 관리번호로 결제 테이블의 카드 정보 조회<br>
  - 조회하여 취소 테이블에 입력<br>
 〮 response 추가 (결제테이블, 취소테이블 이력을 조회하여 남은 금액의 합계 리턴)<br>
  - 남은 총 결제금액<br>
  - 남은 결제금액<br>
  - 남은 부가세금액  <br>
 〮 취소API는 취소 테이블에 INSERT<br>
  - INSERT시 결제 테이블의 카드정보를 조회하여 카드정보를 조건으로 동시에 같은 카드번호 입력이 되고 있다면 처리 불가<br><br>
  
  * validate 체크<br>
  - 결제금액이 0원인경우 <br>
  - 남은 총금액보다 req(결제금액+부가가치세금액)이 큰경우<br>
  - 남은 결제금액보다 req(결제금액)이 큰경우<br>
  - 남은 부가가치세 금액보다 req(부가가치세금액)이 큰경우<br>

3. 조회  API 전략<br>
 〮 response 추가 (결제테이블, 취소테이블 이력을 조회하여 남은 금액의 합계 리턴)<br>
  - 남은 총 결제금액<br>
  - 남은 결제금액<br>
  - 남은 부가세금액<br>
